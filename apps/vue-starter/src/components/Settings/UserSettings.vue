<script setup lang="ts">
import { ref, computed, onMounted } from "vue";
import { useI18n } from "vue-i18n";
import { themeSwitcher } from "@siemens/ix";
import { IxTypography, IxRadio, IxRadioGroup } from "@siemens/ix-vue";
import { useShowDemoMessage } from "../../helpers/demoMessage";

import brand from "../../assets/images/brand.png";
import classic from "../../assets/images/classic.png";
import styles from "./styles.module.css";

const { t, locale } = useI18n({ useScope: 'global' });
const showDemoMessage = useShowDemoMessage();

type Theme = "brand" | "classic";
type Language = "en" | "de";

const themes = [
  { name: "Siemens Brand", value: "brand" as Theme, image: brand },
  { name: "Classic", value: "classic" as Theme, image: classic },
] as const;

function getThemeName(): Theme {
  const currentVariant = themeSwitcher.getCurrentTheme();
  const themeParts = currentVariant.split('-');
  return (themeParts[1] as Theme) || "brand";
}

const currentTheme = ref<Theme>(getThemeName());

const currentLanguage = computed<Language>({
  get: () => locale.value as Language,
  set: (lang: Language) => {
    locale.value = lang;
    localStorage.setItem("language", lang);
  }
});

onMounted(() => {
  const savedLanguage = localStorage.getItem("language") as Language;
  if (savedLanguage && (savedLanguage === "en" || savedLanguage === "de")) {
    currentLanguage.value = savedLanguage;
  }
});

function changeLanguage(language: Language) {
  currentLanguage.value = language;
}

function getThemeFullName(): string {
  const currentVariant = themeSwitcher.getCurrentTheme();
  const themeParts = currentVariant.split('-');
  themeParts[1] = currentTheme.value;
  return themeParts.join('-');
}

function changeTheme(theme: Theme) {
  currentTheme.value = theme;
  document.body.className = getThemeFullName();
}

function handleThemeClick(event: Event, theme: Theme) {
  event.preventDefault();
  event.stopPropagation();
  changeTheme(theme);
}
</script>

<template>
  <div :class="styles.UserSettings">
    <IxTypography format="h4">{{ t("theme.title", "Theme") }}</IxTypography>
    <section :class="styles.ThemeSelection">
      <div v-for="theme in themes" :key="theme.value" :class="styles.ThemeButton"
        @click="(event) => handleThemeClick(event, theme.value)">
        <div :class="[styles.ThemeImagePreview, { [styles.Active]: currentTheme === theme.value }]">
          <img :src="theme.image" :alt="`${theme.name} theme`" draggable="false" />
        </div>
        <div>
          <IxRadio :id="theme.value" :checked="currentTheme === theme.value"
            @checkedChange="() => changeTheme(theme.value)" :label="theme.name" />
        </div>
      </div>
    </section>
    <section>
      <IxTypography :class="styles.HeadlineLanguage" format="h4">
        {{ t("language.title") }}
      </IxTypography>
      <section :class="styles.LanguageSelection">
        <IxRadioGroup>
          <IxRadio id="l_en" :checked="currentLanguage === 'en'" @checkedChange="() => changeLanguage('en')"
            :label="t('language.en')" />
          <IxRadio id="l_de" :checked="currentLanguage === 'de'" @checkedChange="() => changeLanguage('de')"
            :label="t('language.de')" />
        </IxRadioGroup>
      </section>
    </section>
  </div>
</template>